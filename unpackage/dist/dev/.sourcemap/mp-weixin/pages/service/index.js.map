{"version":3,"file":"index.js","sources":["pages/service/index.vue","../../../soft/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VydmljZS9pbmRleC52dWU"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<view class=\"od-banner\">\r\n\t\t\t<image class=\"od-banner-icon\" src=\"/static/resource/images/od_bg_icon.png\" mode=\"widthFix\"></image>\r\n\t\t\t<view class=\"od-jd od-jd-0\">\r\n\t\t\t\t<view class=\"od-jd-out\">\r\n\t\t\t\t\t<view class=\"od-jd-in\"></view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"vp-flex od-jd-text\">\r\n\t\t\t\t\t<view class=\"vp-flex_1\">\r\n\t\t\t\t\t\t<text class=\"od-jd-st-0\">填写订单</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"vp-flex_1\">\r\n\t\t\t\t\t\t<text class=\"od-jd-st-10\">在线支付</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"vp-flex_1\">\r\n\t\t\t\t\t\t<text class=\"od-jd-st-20\">专人服务</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"vp-flex_1\">\r\n\t\t\t\t\t\t<text class=\"od-jd-st-30\">服务完成</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"pub-box\">\r\n\t\t\t<view class=\"pub-box-bd\">\r\n\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t<image class=\"serv-icon\"\r\n\t\t\t\t\t\t\t:src=\"service.icon_image ? service.icon_image_url : '/static/resource/images/avatar_def.png'\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t<text class=\"serv-name\">{{ service.name }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"weui-cell__ft\">\r\n\t\t\t\t\t\t<view class=\"f5 ic_info\" @click=\"handleTap\">服务内容</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<block v-if=\"service.stype == 10 || service.stype == 15 || service.stype == 20\">\r\n\t\t\t<view class=\"pub-box\">\r\n\t\t\t\t<view class=\"pub-box-bd\">\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">就诊医院</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t<picker @change=\"onHospitalChange\" :value=\"hospital_index\" :range=\"hospitals\"\r\n\t\t\t\t\t\t\t\t\trange-key=\"name\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"text\" :disabled=\"true\" placeholder=\"请选择就诊医院\"\r\n\t\t\t\t\t\t\t\t\t\t:value=\"hospitals[hospital_index].name\" placeholder-class=\"vp-placeholder\" />\r\n\t\t\t\t\t\t\t\t</picker>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">就诊时间</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t<dtPicker @dtPickerChanged=\"onStartTimeChanged\" placeholder=\"请选择就诊时间\"\r\n\t\t\t\t\t\t\t\t\t:timestamp=\"order.starttime\"></dtPicker>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\" @click=\"onClinetChange\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">就诊人</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"weui-input\" placeholder-class=\"vp-placeholder\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"请选择就诊人\" style=\"text-align: right\" :disabled=\"true\"\r\n\t\t\t\t\t\t\t\t\t:value=\"client.name\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<block v-if=\"service.stype == 15\">\r\n\t\t\t\t\t\t<!-- 接送陪诊 -->\r\n\t\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t\t<view class=\"weui-cell__hd\">接送地址</view>\r\n\t\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t\t<input class=\"weui-input\" name=\"receiveAddress\" style=\"text-align: right\"\r\n\t\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" placeholder=\"请填写就诊人所在地址\"\r\n\t\t\t\t\t\t\t\t\tv-model=\"order.receiveAddress\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">联系电话</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t<input class=\"weui-input\" type=\"number\" name=\"tel\" style=\"text-align: right\"\r\n\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" placeholder=\"请填写您的联系电话\" v-model=\"order.tel\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"pub-box\">\r\n\t\t\t\t<view class=\"pub-box-tt\">服务需求</view>\r\n\t\t\t\t<view class=\"pub-box-bd\">\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t<textarea name=\"demand\" auto-height placeholder=\"请简单描述您要就诊的科室..\"\r\n\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" style=\"min-height: 150rpx\" v-model=\"order.demand\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</block>\r\n\t\t<block v-if=\"service.stype == 30 || service.stype == 40\">\r\n\t\t\t<!-- 送取结果,代跑取药 -->\r\n\t\t\t<view class=\"pub-box\">\r\n\t\t\t\t<view class=\"pub-box-bd\">\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">所在医院</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t<picker @change=\"onHospitalChange\" :value=\"hospital_index\" :range=\"hospitals\"\r\n\t\t\t\t\t\t\t\t\trange-key=\"name\">\r\n\t\t\t\t\t\t\t\t\t<input type=\"text\" :disabled=\"true\" placeholder=\"请选择就诊所在医院\"\r\n\t\t\t\t\t\t\t\t\t\t:value=\"hospitals[hospital_index].name\" placeholder-class=\"vp-placeholder\" />\r\n\t\t\t\t\t\t\t\t</picker>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">服务时间</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t<dtPicker @dtPickerChanged=\"onStartTimeChanged\" :timestamp=\"order.starttime\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"请选择期望服务时间\"></dtPicker>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\" @click=\"onAddressChange\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t<view class=\"weui-label\">收件信息</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\"></view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\">\r\n\t\t\t\t\t\t\t<input class=\"weui-input\" :disabled=\"true\" style=\"text-align: right\"\r\n\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" placeholder=\"请选择收件信息\" :value=\"\r\n\t\t\t\t\t\t\t\t\torder.address.userName ? order.address.userName + '(' + order.address.cityName + order.address.countyName + order.address.detailInfo + ')' : ''\r\n\t\t\t\t\t\t\t\t\" />\r\n\t\t\t\t\t\t\t<!-- {{order.address?(order.address.userName+'('+order.address.telNumber+')'):''}} -->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__hd\">联系电话</view>\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t<input class=\"weui-input\" type=\"number\" name=\"tel\" style=\"text-align: right\"\r\n\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" placeholder=\"请填写您的联系电话\" v-model=\"order.tel\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"pub-box\">\r\n\t\t\t\t<view class=\"pub-box-tt\">服务需求</view>\r\n\t\t\t\t<view class=\"pub-box-bd\">\r\n\t\t\t\t\t<view class=\"weui-cell weui-cell_input\">\r\n\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t<textarea name=\"demand\" auto-height placeholder=\"如有其他服务要求请在此填写..\"\r\n\t\t\t\t\t\t\t\tplaceholder-class=\"vp-placeholder\" style=\"min-height: 150rpx\" v-model=\"order.demand\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</block>\r\n\t\t<view style=\"height: 300rpx\"></view>\r\n\t\t<!-- 悬浮提交按钮 -->\r\n\t\t<view class=\"vp-foot\">\r\n\t\t\t<view style=\"background: #ffffff; padding: 20rpx\">\r\n\t\t\t\t<view class=\"xieyi\" style=\"text-align: center\">\r\n\t\t\t\t\t<text :class=\"'is_xieyi ' + (is_xieyi ? 'is_xieyi_on' : '')\" @click=\"onXieyiChange\">我已阅读并同意</text>\r\n\t\t\t\t\t<navigator :url=\"cfg.page_xy\">《用户协议》</navigator>\r\n\t\t\t\t\t<text>和</text>\r\n\t\t\t\t\t<navigator :url=\"cfg.page_fw\">《服务协议》</navigator>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<button :class=\"'btnp ' + (is_xieyi ? '' : 'btnp-disabled')\" @click=\"submit\">\r\n\t\t\t\t\t\t确认下单\r\n\t\t\t\t\t\t<block v-if=\"order.price > 0\">（支付{{ order.price }}元）</block>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view>\r\n\t\t\t\t<button @click=\"open\">打开弹窗</button>\r\n\t\t\t\t<uni-popup ref=\"popup\" type=\"bottom\" border-radius=\"10px 10px 0 0\">底部弹出 Popup 自定义圆角</uni-popup>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<uni-popup ref=\"popup\" type=\"center\" :is-mask-click=\"false\" background-color=\"#fff\">\r\n\t\t\t<view class=\"popup-content\">\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" type=\"tel\" v-model=\"validMobile.phone\" placeholder=\"手机号\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" v-model=\"validMobile.validCode\" placeholder=\"验证码\" />\r\n\t\t\t\t\t<text class=\"valid-text\" @click=\"countdownChange\">{{countdown.validText}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"btns\">\r\n\t\t\t\t<view class=\"cancal\" @click=\"cancal\">取消</view>\r\n\t\t\t\t<view class=\"ok\" @click=\"ok\">确定</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<uni-popup ref=\"qrcodePopup\" type=\"center\" :is-mask-click=\"false\" background-color=\"#fff\">\r\n\t\t\t<view class=\"pay-box\">\r\n\t\t\t\t<image @click=\"payment\" src=\"/static/resource/images/modal_closer.png\" style=\"display: block;width: 30rpx;height: 30rpx;\"></image>\r\n\t\t\t\t<view class=\"text-center\">微信支付</view>\r\n\t\t\t\t<canvas id=\"qrcode\" canvas-id=\"qrcode\" style=\"width: 300rpx;height: 300rpx;\"></canvas>\r\n\t\t\t\t<view class=\"text-center\">请用微信扫码支付</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tcomputed,\r\n\t\treactive,\r\n\t\tref,\r\n\t\ttoRaw\r\n\t} from 'vue';\r\n\timport {\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app';\r\n\timport UQRCode from 'uqrcodejs';\r\n\r\n\tconst app = getApp();\r\n\tconst popup = ref();\r\n\tconst qrcodePopup = ref();\r\n\r\n\tconst open = () => {\r\n\t\tconsole.log(popup.value);\r\n\t\tconsole.log('弹出层');\r\n\t\tthis.$refs.popup.open('top')\r\n\t};\r\n\tonLoad((options) => {\r\n\t\tconsole.log(options, 'options');\r\n\t\tmain_load(options);\r\n\t});\r\n\r\n\t//页面服务数据\r\n\tconst service = ref({});\r\n\t///医院的列表\r\n\tconst hospitals = ref([]);\r\n\t//选中医院的索引\r\n\tconst hospital_index = ref(0);\r\n\t//是否同意协议\r\n\tconst is_xieyi = ref(false);\r\n\t//手机验证\r\n\tconst validMobile = reactive({\r\n\t\tphone: '',\r\n\t\tvalidCode: ''\r\n\t})\r\n\t//验证码文本信息\r\n\tconst countdown = reactive({\r\n\t\tvalidText: '获取验证码',\r\n\t\ttime: 60\r\n\t})\r\n\t//订单的数据\r\n\tconst order = reactive({\r\n\t\tprice: '',\r\n\t\tstarttime: '',\r\n\t\taddress: {\r\n\t\t\tuserName: '',\r\n\t\t\tcityName: '',\r\n\t\t\tcountyName: '',\r\n\t\t\tdetailInfo: ''\r\n\t\t},\r\n\t\treceiveAddress: '',\r\n\t\ttel: '',\r\n\t\tdemand: ''\r\n\t});\r\n\r\n\tconst client = reactive({\r\n\t\tname: ''\r\n\t});\r\n\r\n\tconst cfg = reactive({\r\n\t\tpage_xy: '',\r\n\t\tpage_fw: ''\r\n\t});\r\n\r\n\tconst main_load = (options) => {\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/Service/order',\r\n\t\t\tdata: {\r\n\t\t\t\tsvid: options.svid\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t\tservice.value = res.data.service;\r\n\t\t\t\thospitals.value = res.data.hospitals;\r\n\t\t\t\t//默认选中\r\n\t\t\t\tconst hospitalsData = toRaw(hospitals.value);\r\n\t\t\t\tif (options.hid > 0) {\r\n\t\t\t\t\tfor (let i = 0; i < hospitalsData.length; i++) {\r\n\t\t\t\t\t\tif (hospitalsData[i].id == options.hid) {\r\n\t\t\t\t\t\t\thospital_index.value = i;\r\n\t\t\t\t\t\t\torder.price = hospitalsData[i].service_price;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tconst handleTap = () => {\r\n\t\tconsole.log('弹出层');\r\n\t};\r\n\r\n\t//改变医院数据提醒\r\n\tconst onHospitalChange = (e) => {\r\n\t\tconst value = parseInt(e.detail.value);\r\n\t\thospital_index.value = value;\r\n\t\torder.price = toRaw(hospitals.value)[value].service_price;\r\n\t};\r\n\t//修改日期后的回调\r\n\r\n\tconst onStartTimeChanged = (e) => {\r\n\t\t// console.log(e);\r\n\t\torder.starttime = e.detail.value\r\n\t};\r\n\r\n\t//选择就诊人\r\n\tconst onClinetChange = (e) => {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '../clients/index?act=select'\r\n\t\t});\r\n\t};\r\n\r\n\t//创建监听全局的自定义事件\r\n\tuni.$on('clientChange', (data) => {\r\n\t\tconsole.log(data);\r\n\t\tclient.name = data.name;\r\n\t\tclient.id = data.id;\r\n\t\tclient.sex = data.sex;\r\n\t\tclient.age = data.age;\r\n\t\tclient.mobile = data.mobile;\r\n\t});\r\n\r\n\tconst onXieyiChange = () => {\r\n\t\tis_xieyi.value = !is_xieyi.value;\r\n\t};\r\n\tconst onAddressChange = () => {\r\n\t\tuni.chooseAddress({\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t\torder.address.userName = res.userName;\r\n\t\t\t\torder.address.cityName = res.cityName;\r\n\t\t\t\torder.address.countyName = res.countyName;\r\n\t\t\t\torder.address.detailInfo = res.detailInfo;\r\n\t\t\t},\r\n\t\t\tfail: (res) => {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tlet submitOrder = {};\r\n\t//下单\r\n\tconst submit = () => {\r\n\t\tconsole.log(is_xieyi.value)\r\n\t\tif (!is_xieyi.value) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请先阅读并同意协议和服务协议',\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\tduration: 1500\r\n\t\t\t});\r\n\t\t}\r\n\t\tconst orderData = toRaw(order)\r\n\t\tconst serviceData = toRaw(service.value)\r\n\t\tconst hospitalsData = toRaw(hospitals.value)\r\n\t\tconst clientData = toRaw(client)\r\n\r\n\t\torderData.service_code = serviceData.code\r\n\t\torderData.service_id = serviceData.id\r\n\t\torderData.service_name = serviceData.name\r\n\t\torderData.service_stype = serviceData.stype\r\n\r\n\t\t//医院的选择校验\r\n\t\tif (serviceData.stype < 100) {\r\n\t\t\tif (hospital_index.value == 0) {\r\n\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\ttitle: '请选择医院',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\torderData.hospital_id = hospitalsData[hospital_index.value].id\r\n\t\t\torderData.hospital_name = hospitalsData[hospital_index.value].name\r\n\r\n\t\t\tif (!orderData.starttime) {\r\n\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\ttitle: '请选择服务时间',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//服务类型为陪诊\r\n\t\t\tif (serviceData.stype == 10 || serviceData.stype == 15 || serviceData.stype == 20) {\r\n\t\t\t\t//就诊人验证\r\n\t\t\t\tif (!clientData.id) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '请选就诊人',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 1500\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\torderData.client = {}\r\n\t\t\torderData.client.age = clientData.age\r\n\t\t\torderData.client.mobile = clientData.mobile\r\n\t\t\torderData.client.name = clientData.name\r\n\t\t\torderData.client.sex = clientData.sex\r\n\r\n\t\t\t//接送地址验证\r\n\t\t\tif (serviceData.stype == 15) {\r\n\t\t\t\tif (!orderData.receiveAddress) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '请选就诊人所在地址',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 1500\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (serviceData.stype == 30 || serviceData.stype == 40) {\r\n\t\t\t//收件地址是否存在\r\n\t\t\tif (!orderData.address.userName) {\r\n\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\ttitle: '请选择收件信息',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t//判断联系电话\r\n\t\tif (!orderData.tel) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请填写联系方式',\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\tduration: 1500\r\n\t\t\t});\r\n\t\t}\r\n\t\tsubmitOrder = orderData\r\n\t\tconsole.log(orderData)\r\n\t\t//判断用户是否登录\r\n\t\tif (!uni.getStorageSync('token')) {\r\n\t\t\tpopup.value.open('center')\r\n\t\t} else {\r\n\t\t\t//下单逻辑\r\n\t\t\tcreateOrder(submitOrder)\r\n\t\t}\r\n\r\n\t};\r\n\tconst calcal = () => {\r\n\t\tpopup.value.close()\r\n\t}\r\n\tconst ok = () => {\r\n\t\t//检查手机号和验证码\r\n\t\tif (!validMobile.phone || !validMobile.validCode) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请检查数据',\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\tduration: 1000\r\n\t\t\t})\r\n\t\t}\r\n\t\t//验证短信\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/user/authentication',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.phone,\r\n\t\t\t\tcode: validMobile.validCode\r\n\t\t\t},\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tuni.setStorageSync('token', res.data.token)\r\n\t\t\t\t//下单逻辑\r\n\t\t\t\tcreateOrder(submitOrder)\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1000\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tlet flag = false\r\n\tconst countdownChange = () => {\r\n\r\n\t\t//判断手机号是否存在\r\n\t\tif (!validMobile.phone) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\tduration: 1000\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (flag) return\r\n\t\tconst time = setInterval(() => {\r\n\t\t\tif (countdown.time <= 0) {\r\n\t\t\t\tcountdown.validText = '获取验证码'\r\n\t\t\t\tcountdown.time = 60\r\n\t\t\t\tflag = false\r\n\t\t\t\tclearInterval(time)\r\n\t\t\t} else {\r\n\t\t\t\tcountdown.time -= 1\r\n\t\t\t\tcountdown.validText = `剩余${countdown.time}s`\r\n\t\t\t}\r\n\t\t}, 1000)\r\n\t\tflag = true\r\n\t\t//发送验证码\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/get/code',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.phone\r\n\t\t\t},\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '验证码已发送，请尽快验证！',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1000\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 1000\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//创建订单\r\n\tconst createOrder = (orderData) => {\r\n\t\tconsole.log(orderData)\r\n\t\t// return\r\n\t\t//调用下单接口\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/pay/createOrder',\r\n\t\t\tmethod: 'POST',\r\n\t\t\theader: {\r\n\t\t\t\ttoken: uni.getStorageSync('token')\r\n\t\t\t},\r\n\t\t\tdata: orderData,\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tqrcodePopup.value.open('center')\r\n\t\t\t\t// 获取uQRCode实例\r\n\t\t\t\tvar qr = new UQRCode();\r\n\t\t\t\t// 设置二维码内容\r\n\t\t\t\tqr.data = res.wxcode;\r\n\t\t\t\t// 设置二维码大小，必须与canvas设置的宽高一致\r\n\t\t\t\tqr.size = 150;\r\n\t\t\t\t// 调用制作二维码方法\r\n\t\t\t\tqr.make();\r\n\t\t\t\t// 获取canvas上下文\r\n\t\t\t\tvar canvasContext = uni.createCanvasContext('qrcode', this); // 如果是组件，this必须传入\r\n\t\t\t\t// 设置uQRCode实例的canvas上下文\r\n\t\t\t\tqr.canvasContext = canvasContext;\r\n\t\t\t\t// 调用绘制方法将二维码图案绘制到canvas上\r\n\t\t\t\tqr.drawCanvas();\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t//跳转订单列表\r\n\tconst payment = () =>{\r\n\t\tuni.switchTab({\r\n\t\t\turl:'../order/index'\r\n\t\t})\r\n\t}\r\n</script>\r\n\r\n\r\n<style>\r\n\t@import './index.css';\r\n</style>","import MiniProgramPage from 'D:/pro/unipro/uniapp_study/pages/service/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","reactive","toRaw","UQRCode","MiniProgramPage"],"mappings":"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"}